# flutter_bloc 6.1.0 多了什麼

新增時間: August 11, 2021 1:07 PM
最後編輯時間: October 2, 2025 11:56 PM
id: b169dd8feb96405ca5f2e9859a091c43
完成: Yes
類型: Medium
🧩 領域: Flutter (https://www.notion.so/Flutter-aec5ea3a198f49e18989ab7f4c851169?pvs=21)

### bloc 6.1.0的變化

把flutter_bloc更新到6.1.0以上時，會發現專案出現很多context.bloc的warning。

![](flutter_bloc%206%201%200%20%E5%A4%9A%E4%BA%86%E4%BB%80%E9%BA%BC/_2020-12-30_9.52.35.png)

提示訊息會指明context.bloc()和context.repository()被已經deprecated，並預計在flutter_bloc 7.0.0時停止支援，建議改成context.read()或context.watch()。

如果查看[flutter_bloc](https://pub.dev/packages/flutter_bloc/changelog)的Change log，會發現從6.1.0新增method中，除了context.read()和context.watch()之外，還有context.select()。今天就來講講這三個新增的method如何使用。

### 為什麼要移除bloc

作者Felix發現許多人對state的誤用，直接在build使用context.bloc<CounterBloc>().state來決定畫面，而不是使用BlocBuilder，導致state發生改變時，畫面沒有跟著變化。為了減少這種情況，所以新增了watch和read來改善。為減少這樣的狀況，所以開了一些新的api，並在該api中限制使用方式來減少這些狀況的發生。

---

### 新增的三個方法

**watch**

- 只能在build中使用
- 當state改變時會重新build

```dart
@override
Widget build(BuildContext context) {
  int count = context.watch<CounterBloc>().state.count;
  return Scaffold(
    appBar: AppBar(
      title: Text(widget.title),
    ),
    body: Text(
      '$count',
    ),
  );
}
```

**select**

- 與只能在build中使用
- 當selector中的狀態改變時會重新build

```dart
@override
Widget build(BuildContext context) {
  int count = context.select<CounterBloc, int>((bloc) => bloc.state.count);
  return Scaffold(
    appBar: AppBar(
      title: Text(widget.title),
    ),
    body: Text(
      '$count',
    ),
  );
}
```

**read**

- 不能在build中使用
- 當state改變時不會重新build

```dart
@override
Widget build(BuildContext context) {
  int count = context.watch<CounterBloc>().state.count;
  return Scaffold(
    appBar: AppBar(
      title: Text(widget.title),
    ),
    body: Text(
      '$count',
    ),
    floatingActionButton: FloatingActionButton(
      onPressed: () {
        context.read<CounterBloc>().add(CounterEvent());
      },
      child: Icon(Icons.add),
    ),
  );
}
```

### 延伸思考

- 如何在build中取用bloc，但是又不在狀態改變時觸發rebuild
    - 也就是原本context.bloc的做法
    
    ```dart
    BlocProvider.of<CounterBloc>(context).add(CounterEvent())
    ```
    
- watch適合用在需要觸發整個widget的rebuild
    - 通常會使得widget越拆越細

### 參考

[https://github.com/felangel/bloc/issues/1902](https://github.com/felangel/bloc/issues/1902)

[https://www.youtube.com/watch?v=TNVxDuSJ00I&t=599s](https://www.youtube.com/watch?v=TNVxDuSJ00I&t=599s)