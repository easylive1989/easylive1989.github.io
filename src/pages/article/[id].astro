---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import type { Article, ArticlesData } from '../../types';
import { processMarkdownContent, formatDate } from '../../utils/markdown';
import articlesData from '../../../public/articles.json';

export async function getStaticPaths() {
    const data = articlesData as any;

    return data.articles.map((article: Article) => ({
        params: { id: article.id },
        props: { article },
    }));
}

const { article } = Astro.props as { article: Article };

// Process markdown content
const processedContent = processMarkdownContent(article.content || '', article, false);

// We'll use a client-side library for markdown rendering
// For now, let's use Astro's built-in markdown support
---

<BaseLayout title={`${article.title} - 保羅軟體開發`} description={article.summary}>
    <Header />

    <main>
        <div class="container">
            <div style="max-width: 1200px; margin: 0 auto;">
                <a href="/" class="nav-button" style="display: inline-flex; align-items: center; gap: 8px; margin-bottom: 20px; text-decoration: none;">
                    ← 返回文章列表
                </a>

                <div class="article-detail-header">
                    <h1 class="article-detail-title">{article.title}</h1>
                    <div class="article-detail-meta">
                        <span>新增時間: {formatDate(article.createdAt)}</span>
                        <span class="article-tag">{article.tag}</span>
                    </div>
                </div>

                <div class="article-detail-content" id="article-content">
                    <!-- Content will be rendered here -->
                </div>
            </div>
        </div>
    </main>

    <Footer />

    <script define:vars={{ processedContent }}>
        // Use marked.js to render markdown
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/marked/marked.min.js';
        script.onload = () => {
            const contentEl = document.getElementById('article-content');
            if (contentEl && window.marked) {
                contentEl.innerHTML = window.marked.parse(processedContent);
            }
        };
        document.head.appendChild(script);
    </script>
</BaseLayout>
